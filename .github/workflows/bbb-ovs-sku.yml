name: BBB SKU Extract from OVS Variants

on:
  workflow_dispatch:
    inputs:
      input_filename:
        description: "Input CSV filename"
        required: true
        default: "products_chunk_0.csv"
        type: string
      total_chunks:
        description: "Number of chunks"
        required: true
        default: "1"  # Reduced to 1 for sequential processing
        type: string

jobs:
  extract:
    runs-on: ubuntu-latest
    timeout-minutes: 240  # Increased timeout
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: "3.10"
      
      - name: Download input file
        run: |
          # Download your input file here
          echo "Using input file: ${{ github.event.inputs.input_filename }}"
      
      - name: Install dependencies
        run: |
          pip install pandas requests
      
      - name: Run BBB Extractor (Single-threaded)
        run: |
          python bbb_simple.py \
            --chunk-id 1 \
            --total-chunks ${{ github.event.inputs.total_chunks }} \
            --input-file "${{ github.event.inputs.input_filename }}" \
            --timeout 30
      
      - name: Upload results
        uses: actions/upload-artifact@v4
        with:
          name: bbb-results
          path: output/